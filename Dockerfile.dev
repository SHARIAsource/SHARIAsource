FROM --platform=linux/amd64 ruby:2.4.1-stretch 


# add the below archived repositories to /etc/apt/sources.list (stretch is past EOL)
RUN echo -n > etc/apt/sources.list
RUN echo "deb http://archive.debian.org/debian/ stretch main non-free contrib" >> /etc/apt/sources.list
RUN echo "deb-src http://archive.debian.org/debian/ stretch main non-free contrib" >> /etc/apt/sources.list
RUN echo "deb http://archive.debian.org/debian-security stretch/updates main contrib non-free" >> /etc/apt/sources.list

RUN apt-get update
RUN apt-get install -y apt-transport-https ca-certificates gnupg2 curl imagemagick libmagickwand-dev

ENV RAILS_ROOT /var/www/app
RUN mkdir -p $RAILS_ROOT

WORKDIR $RAILS_ROOT

# Add Rails gems
COPY Gemfile Gemfile
COPY Gemfile.lock Gemfile.lock

RUN gem install bundler:1.16.1
RUN bundle _1.16.1_ install
# RUN bundle _1.16.1_ update
# RUN bundle _1.16.1_ install

# RUN gem install bundler

COPY . .

EXPOSE 3000 3001

RUN rake start